<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Portal HUD Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="icon.ico">

<!-- Portal-y fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --appliance:#f6f7f8;
    --panel:#ffffff;
    --steel:#d9dee4;
    --ink:#0b1721;
    --blue:#25a8ff;
    --orange:#ff7a00;
    --ok:#21b355; --warn:#ffb700; --bad:#e04444;
  }

  /* Page & background */
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans";
    color:var(--ink);
    background:linear-gradient(180deg,#fbfdff 0,#eef3f7 100%);
  }

  /* Fixed side banners */
  .frame{
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    position:relative;
    overflow-x:hidden;
  }
.side{
  position:fixed;
  top:50%;                           /* center vertically */
  transform:translateY(-50%);        /* perfectly center the banner */
  width:220px;                       /* adjust for width of your image */
  height:auto;
  object-fit:contain;                /* keeps aspect ratio clean */
  z-index:0;
  opacity:0.55;
  filter:saturate(1.05) contrast(1.02);
  pointer-events:none;
}
.side.left{left:0;}
.side.right{right:0;}

  /* Center content wrapper sits above banners */
  .wrap{
    position:relative;
    z-index:1;
    max-width:880px;
    margin:40px auto;
    padding:0 24px;
  }

  /* Main card */
  .card{
    background:var(--panel);
    border:1px solid var(--steel);
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.05);
    overflow:hidden;
  }

  /* Header */
  .hd{
    display:flex;align-items:center;gap:12px;
    padding:14px 16px;
    background:repeating-linear-gradient(135deg,#fff 0 14px,#f7fafc 14px 28px);
    border-bottom:1px solid var(--steel);
  }
  .logo{
    width:28px;height:28px;border-radius:8px;
    background:#fff url(icon.ico) center/cover no-repeat;
    box-shadow:inset 0 0 0 1px #e8edf2;
    flex:0 0 auto;
  }
  h2{
    margin:0;
    font-family:Orbitron, Inter, system-ui, Segoe UI;
    font-weight:700;
    letter-spacing:.6px;
    font-size:18px;
    text-transform:uppercase;
  }
  .statusrow{
    display:flex;align-items:center;gap:8px;margin-left:auto;
    font-weight:700;font-size:12px;
    padding:6px 10px;border-radius:999px;
    background:linear-gradient(180deg,#fff,#f2f6fa);
    border:1px solid var(--steel);
    font-family:Orbitron, Inter, system-ui, Segoe UI;
    letter-spacing:.3px;
  }
  .dot{width:10px;height:10px;border-radius:50%;background:#9aa6b2}
  .ok{background:var(--ok)} .warn{background:var(--warn)} .bad{background:var(--bad)}

  /* Toolbar */
  .bar{display:flex;flex-wrap:wrap;gap:8px;padding:12px 16px;border-bottom:1px solid var(--steel)}
  button{
    appearance:none;cursor:pointer;
    border-radius:12px;border:1px solid #cfd6dd;
    background:linear-gradient(180deg,#fff,#f4f7fa);
    padding:10px 14px;font-weight:700;letter-spacing:.2px;
    box-shadow:0 1px 2px rgba(0,0,0,.06);
    font-family:Orbitron, Inter, system-ui, Segoe UI;
  }
  button:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}
  .b-blue{border-color:#a9dafc;background:linear-gradient(180deg,#e9f5ff,#d9efff)}
  .b-orange{border-color:#ffd0a6;background:linear-gradient(180deg,#fff3e7,#ffe6cf)}

  /* Content & fieldsets */
  .content{padding:12px 16px 18px}
  fieldset{
    margin:14px 0;padding:12px;border-radius:12px;border:1px solid var(--steel);
    background:#fff; position:relative;
  }
  fieldset legend{
    padding:0 8px;font-weight:800;text-transform:uppercase;font-size:11px;color:#3d5266;
    font-family:Orbitron, Inter, system-ui, Segoe UI; letter-spacing:.5px;
  }
  /* Portal accent bar under each section */
  fieldset::before{
    content:"";position:absolute;left:10px;right:10px;top:0;
    height:3px;transform:translateY(-1px);
    background:linear-gradient(90deg,var(--blue) 0 55%,var(--orange) 55% 100%);
    border-radius:2px;
  }

  label{
    display:grid;grid-template-columns:260px 1fr;
    gap:10px;align-items:center;margin:8px 0;
    font-weight:600;color:#1f3144;
  }
  input[type=number]{
    width:180px;padding:8px 10px;border-radius:10px;
    border:1px solid #cfd6dd;background:#fff;font-weight:700;
    outline:none;transition:border .15s, box-shadow .15s;
    font-family:Inter, system-ui, Segoe UI;
  }
  input[type=number]:focus{
    border-color:#9ed4ff; box-shadow:0 0 0 3px rgba(37,168,255,.15);
  }

  /* Footer */
  .foot{
    display:flex;justify-content:flex-end;padding:8px 16px 14px;color:#576777;font-size:12px
  }

  /* Responsiveness for smaller screens */
  @media (max-width:1000px){
    .side{width:150px;opacity:.5}
  }
  @media (max-width:780px){
    .side{display:none}           /* hide banners on very small screens */
    .wrap{padding:0 16px}
    label{grid-template-columns:1fr}
    input[type=number]{width:100%}
  }
</style>
</head>
<body>
  <div class="frame">
    <img src="left.png" alt="" class="side left">
    <div class="wrap">
      <div class="card">
        <div class="hd">
          <div class="logo" aria-hidden="true"></div>
          <h2>Portal HUD Control</h2>
          <div class="statusrow">
            <span class="dot" id="dot"></span>
            <span id="status">Connecting…</span>
          </div>
        </div>

        <div class="bar">
          <button class="b-ghost" onclick="loadCfg()">⟳ Refresh</button>
          <button class="b-blue"  onclick="saveCfg()">⇪ Save to ESP</button>
          <button class="b-orange" onclick="pause()">⏸ Pause telemetry</button>
          <button class="b-ghost"  onclick="resume()">▶ Resume</button>
        </div>

        <div class="content">
          <fieldset>
            <legend>Eye</legend>
            <label>Blink min (ms) <input id="blinkMin" type="number"></label>
            <label>Blink max (ms) <input id="blinkMax" type="number"></label>
            <label>Saccade min (ms) <input id="saccMin" type="number"></label>
            <label>Saccade max (ms) <input id="saccMax" type="number"></label>
          </fieldset>

          <fieldset>
            <legend>Screen sequence</legend>
            <label>Temp screen (ms) <input id="tempScreenMs" type="number"></label>
            <label>Eye screen (ms)  <input id="eyeScreenMs"  type="number"></label>
          </fieldset>

          <fieldset>
            <legend>Priority</legend>
            <label>High temp (°C) <input id="highTempC" type="number" step="0.1"></label>
            <label>Low  temp (°C) <input id="lowTempC"  type="number" step="0.1"></label>
            <label>Low-temp dwell (ms) <input id="lowTempDwellMs" type="number"></label>
          </fieldset>

          <fieldset>
            <legend>Timeout &amp; Fade</legend>
            <label>Telemetry timeout (ms) <input id="telemetryTimeoutMs" type="number"></label>
            <label>Fade (ms) <input id="fadeMs" type="number"></label>
          </fieldset>
        </div>

        <div class="foot">
          Aperture Diagnostics:
          <span style="margin-left:6px;font-family:ui-monospace,Consolas">http://127.0.0.1:8765</span>
        </div>
      </div>
    </div>
    <img src="right.png" alt="" class="side right">
  </div>

<script>
/* ---- ORIGINAL LOGIC (unchanged) ---- */
const API = '';

function setStatus(text, cls){
  const s = document.getElementById('status');
  const d = document.getElementById('dot');
  s.textContent = text;
  d.className = 'dot ' + (cls||'');
}

async function pollStatus(){
  try{
    const r = await fetch(API + '/status', {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j = await r.json();
    const port = j.serial || '(none)';
    const paused = !!j.paused_pc;
    setStatus(paused ? `Connected ${port} — Paused` : `Connected ${port}`, paused?'warn':'ok');
  }catch(e){
    setStatus('Connecting…','');
  }
}
setInterval(pollStatus, 1000); pollStatus();

async function loadCfg(){
  try{
    const r = await fetch(API + '/config/get', {cache:'no-store'}); const j = await r.json();
    if (!j.ok) { setStatus('Failed to load','bad'); console.log(j); return; }
    for (const [k,v] of Object.entries(j.cfg)){
      const el = document.getElementById(k); if (el) el.value = v;
    }
    setStatus('Config loaded','ok');
  }catch(e){
    setStatus('Failed to connect','bad');
  }
}
async function setOne(key){
  const el = document.getElementById(key); if (!el) return;
  const val = el.value;
  const r = await fetch(API + '/config/set', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({key, value:val})});
  const j = await r.json(); if (!j.ok) console.warn('Set failed', key, j);
}
async function saveCfg(){
  const ids = ['blinkMin','blinkMax','saccMin','saccMax','tempScreenMs','eyeScreenMs','highTempC','lowTempC','lowTempDwellMs','telemetryTimeoutMs','fadeMs'];
  for (const id of ids) await setOne(id);
  const r = await fetch(API + '/config/save', {method:'POST'});
  const j = await r.json();
  setStatus(j.ok ? 'Saved' : 'Save failed', j.ok?'ok':'bad');
}
async function pause(){ await fetch(API + '/action/pause', {method:'POST'}); setStatus('Paused','warn'); }
async function resume(){ await fetch(API + '/action/resume', {method:'POST'}); pollStatus(); }
loadCfg();
</script>
</body>
</html>

